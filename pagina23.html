<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITC-PEDIA</title>
    <style>
        body {
            background: #0a0a0a;
            color: #fff;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            padding-top: 80px; /* para que el contenido no quede debajo del nav fijo */
        }
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            z-index: 1000;
            transition: all 0.3s ease;
        }
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
        }
        .logo {
            height: 2.2rem !important;
            width: auto;
            display: block;
        }
        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }
        .nav-links a {
            color: #ffffff;
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
        }
        .nav-links a:hover {
            color: #ff1f1f;
        }
        .nav-links a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -5px;
            left: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }
        .nav-links a:hover::after {
            width: 100%;
        }
        #user-info {
            font-size: 1rem;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        #logout-btn {
            font-size: 1rem;
            padding: 0.3rem 0.8rem;
            border-radius: 16px;
            margin-left: 0.5rem;
            border: none;
            background: #ff1f1f;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            display: none;
        }
        /* Estilos para el contenido principal */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        .title {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: #ff1f1f;
        }
        .subtitle {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            color: #ddd;
        }
        .mode-toggle {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .toggle-btn {
            background: #333;
            color: #fff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 16px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .toggle-btn:hover {
            background: #444;
        }
        .admin-panel {
            background: #222;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: none;
        }
        .admin-panel h2 {
            margin-bottom: 1.5rem;
        }
        .upload-area {
            border: 2px dashed #666;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 1.5rem;
            transition: background 0.3s ease;
        }
        .upload-area:hover {
            background: #333;
        }
        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        .upload-text {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }
        .upload-subtext {
            font-size: 0.9rem;
            color: #aaa;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        .form-input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #444;
            border-radius: 8px;
            background: #111;
            color: #fff;
            font-size: 1rem;
        }
        .form-input:focus {
            border-color: #ff1f1f;
            outline: none;
        }
        .btn-primary {
            background: #ff1f1f;
            color: #fff;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
        }
        .btn-primary:hover {
            background: #e63939;
        }
        .btn-secondary {
            background: #444;
            color: #fff;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
        }
        .btn-secondary:hover {
            background: #555;
        }
        /* Estilos para la biblioteca PDF */
        .pdf-library {
            margin-bottom: 2rem;
        }
        .search-bar {
            margin-bottom: 1.5rem;
        }
        .search-input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #444;
            border-radius: 8px;
            background: #111;
            color: #fff;
            font-size: 1rem;
        }
        .search-input:focus {
            border-color: #ff1f1f;
            outline: none;
        }
        .pdf-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        .pdf-card {
            background: #222;
            border-radius: 8px;
            padding: 1.5rem;
            cursor: pointer;
            transition: transform 0.3s ease, background 0.3s ease;
        }
        .pdf-card:hover {
            transform: translateY(-2px);
            background: #333;
        }
        .pdf-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        .pdf-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .pdf-description {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            color: #ddd;
        }
        .pdf-meta {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            color: #aaa;
        }
        .pdf-category {
            font-size: 0.9rem;
            font-weight: 600;
            color: #ff1f1f;
        }
        .admin-controls {
            margin-top: 1rem;
        }
        .btn-danger {
            background: #ff4d4d;
            color: #fff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
        }
        .btn-danger:hover {
            background: #e63939;
        }
        /* Estilos para el visor de PDF */
        /* PDF Viewer pantalla completa y canvas centrado y responsivo */
        .pdf-viewer {
            display: none;
            flex-direction: column;
            background: #111;
            padding: 0;
            border-radius: 0;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            max-width: 100vw;
            max-height: 100vh;
            margin: 0;
            z-index: 2000;
            box-shadow: none;
        }

        .viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #181818;
            padding: 1rem 2rem;
            border-bottom: 1px solid #222;
        }

        .pdf-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            background: #181818;
            padding: 0.5rem 2rem;
            border-bottom: 1px solid #222;
            gap: 1rem;
        }

        .pdf-viewer {
            overflow: auto;
        }

        .viewer-canvas-container {
            position: relative;
            margin: 0 auto;
            width: fit-content;
            height: fit-content;
        }
        .pdf-canvas {
            display: block;
            position: relative;
            z-index: 5;
            /* NO width ni height aqu√≠ */
        }
        .textLayer, .annotationLayer {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10;
            pointer-events: auto;
            user-select: text;
            /* NO width ni height aqu√≠, solo en JS */
        }
        /* Estado vac√≠o */
        .empty-state {
            text-align: center;
            color: #aaa;
            padding: 2rem;
            border-radius: 8px;
            background: #222;
        }
        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <a href="index.html">
                    <img src="media/logotipo_ITC.svg" alt="ITC Logo" class="logo">
                </a>
                <span id="user-info" style="color: #fff; font-weight: 600;"></span>
                <button id="logout-btn">Salir</button>
            </div>
            <ul class="nav-links">
                <li><a href="https://sistema3.itc.com.ar/" target="_blank" rel="noopener">Sistema actividades</a></li>
                <li><a href="#">HubSpot</a></li>
                <li><a href="#">Speedtest</a></li>
                <li><a href="#">Smart OLT</a></li>
                <li><a href="#">WHM-hosting2</a></li>
                <li><a href="#">ping.eu</a></li>
                <li><a href="#">Blacklists</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <div class="content-container">
            <h1 class="title">Biblioteca Digital<br>ITC-PEDIA</h1>
            <p class="subtitle">
                Accede a toda la documentaci√≥n t√©cnica, manuales, procedimientos y gu√≠as de la organizaci√≥n. 
                Sistema centralizado para gestionar y consultar recursos digitales de forma eficiente y organizada.
            </p>

            <!-- Mode Toggle -->
            <div class="mode-toggle">
                <button class="toggle-btn" id="btn-user-mode">üë• Modo Usuario</button>
                <button class="toggle-btn" id="btn-admin-mode">üîß Modo Admin</button>
            </div>

            <!-- Admin Panel -->
            <div class="admin-panel" id="adminPanel">
                <h2 style="margin-bottom: 30px; color: #ff0000;">Panel de Administraci√≥n</h2>
                
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">üìÑ</div>
                    <div class="upload-text">Arrastra tu archivo PDF aqu√≠</div>
                    <div class="upload-subtext">o haz clic para seleccionar</div>
                    <input type="file" class="file-input" id="fileInput" accept=".pdf">
                </div>

                <div class="form-group">
                    <label class="form-label">T√≠tulo del documento</label>
                    <input type="text" class="form-input" id="docTitle" placeholder="Ej: Manual de Procedimientos 2024">
                </div>

                <div class="form-group">
                    <label class="form-label">Descripci√≥n</label>
                    <textarea class="form-input form-textarea" id="docDescription" placeholder="Descripci√≥n breve del contenido del documento..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Categor√≠a</label>
                    <select class="form-input" id="docCategory">
                        <option value="Manual">Manual</option>
                        <option value="Procedimiento">Procedimiento</option>
                        <option value="Gu√≠a">Gu√≠a</option>
                        <option value="Pol√≠tica">Pol√≠tica</option>
                        <option value="T√©cnico">T√©cnico</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>

                <div>
                    <button class="btn-primary" id="btn-upload">Subir Documento</button>
                    <button class="btn-secondary" id="btn-clear">Limpiar</button>
                </div>
            </div>

            <!-- PDF Library -->
            <div class="pdf-library" id="pdfLibrary">
                <div class="search-bar">
                    <input type="text" class="search-input" id="searchInput" placeholder="üîç Buscar documentos por t√≠tulo, categor√≠a o descripci√≥n...">
                </div>

                <div class="pdf-grid" id="pdfGrid">
                    <!-- Los PDFs aparecer√°n aqu√≠ -->
                </div>

                <div class="empty-state" id="emptyState">
                    <div class="empty-icon">üìö</div>
                    <h3>No hay documentos disponibles</h3>
                    <p>Los documentos subidos aparecer√°n aqu√≠ para su consulta.</p>
                </div>
            </div>

            <!-- PDF Viewer -->
            <div class="pdf-viewer" id="pdfViewer">
                <div class="viewer-header">
                    <h3 id="viewerTitle">Documento</h3>
                    <button class="close-viewer" id="closeViewerBtn">‚úï Cerrar</button>
                </div>
                <div class="pdf-controls">
                    <button class="btn-secondary" id="prevPageBtn">‚Üê Anterior</button>
                    <span id="pageInfo">P√°gina 1 de 1</span>
                    <button class="btn-secondary" id="nextPageBtn">Siguiente ‚Üí</button>
                    <button class="btn-secondary" id="zoomOutBtn">-</button>
                    <span id="zoomLevel">100%</span>
                    <button class="btn-secondary" id="zoomInBtn">+</button>
                </div>
                <div class="viewer-canvas-container">
                    <canvas id="pdfCanvas" class="pdf-canvas"></canvas>
                    <div id="textLayer" class="textLayer"></div>
                    <div id="annotationLayer" class="annotationLayer"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- PDF.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="funciones.js"></script>
    <script>
    let currentMode = 'user';
    let pdfDocuments = [];
    let pdfDoc = null;
    let currentPage = 1;
    let scale = 1.0;
    let currentPdfData = null;
    let userZoom = false;
    let autoScale = 1.0;
    const canvas = document.getElementById('pdfCanvas');
    const ctx = canvas.getContext('2d');

    // PDF.js worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    document.addEventListener('DOMContentLoaded', function() {
        // Modo seg√∫n usuario logueado
        const user = getUsuarioLogueado();
        if (user && user.rol === "admin") {
            setMode('admin');
        } else {
            setMode('user');
        }

        // Botones de modo
        const btnUserMode = document.getElementById('btn-user-mode');
        const btnAdminMode = document.getElementById('btn-admin-mode');
        if (btnUserMode) btnUserMode.addEventListener('click', () => setMode('user'));
        if (btnAdminMode) btnAdminMode.addEventListener('click', () => setMode('admin'));

        // Upload PDF
        document.getElementById('uploadArea').addEventListener('click', () => document.getElementById('fileInput').click());
        document.getElementById('uploadArea').addEventListener('dragover', (e) => {
            e.preventDefault();
            document.getElementById('uploadArea').classList.add('dragover');
        });
        document.getElementById('uploadArea').addEventListener('dragleave', () => {
            document.getElementById('uploadArea').classList.remove('dragover');
        });
        document.getElementById('uploadArea').addEventListener('drop', (e) => {
            e.preventDefault();
            document.getElementById('uploadArea').classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type === 'application/pdf') {
                handleFileUpload(files[0]);
            }
        });
        document.getElementById('fileInput').addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });
        document.getElementById('btn-upload').addEventListener('click', uploadDocument);
        document.getElementById('btn-clear').addEventListener('click', clearForm);

        // PDF Viewer controls
        document.getElementById('closeViewerBtn').addEventListener('click', closePDFViewer);
        document.getElementById('prevPageBtn').addEventListener('click', previousPage);
        document.getElementById('nextPageBtn').addEventListener('click', nextPage);
        document.getElementById('zoomInBtn').addEventListener('click', zoomIn);
        document.getElementById('zoomOutBtn').addEventListener('click', zoomOut);

        // Buscar
        document.getElementById('searchInput').addEventListener('input', (e) => {
            filterDocuments(e.target.value);
        });

        // Demo: carga algunos documentos de ejemplo
        loadSampleDocuments();
        renderPDFGrid();
    });

    function setMode(mode) {
        currentMode = mode;
        const adminPanel = document.getElementById('adminPanel');
        const btnUserMode = document.getElementById('btn-user-mode');
        const btnAdminMode = document.getElementById('btn-admin-mode');
        const user = getUsuarioLogueado();

        // Si el usuario NO es admin, fuerza modo usuario y oculta el bot√≥n de admin
        if (!user || user.rol !== "admin") {
            currentMode = 'user';
            adminPanel.style.display = 'none';
            btnAdminMode.style.display = 'none';
            btnUserMode.style.display = 'none'; // Oculta tambi√©n el bot√≥n de usuario, ya que no hay alternancia
        } else {
            // Usuario admin: muestra ambos botones y el panel seg√∫n el modo
            btnAdminMode.style.display = 'inline-block';
            btnUserMode.style.display = 'inline-block';
            adminPanel.style.display = (mode === 'admin') ? 'block' : 'none';
        }

        btnUserMode.classList.toggle('active', currentMode === 'user');
        btnAdminMode.classList.toggle('active', currentMode === 'admin');
        renderPDFGrid();
    }

    function handleFileUpload(file) {
        if (file.type !== 'application/pdf') {
            alert('Por favor, selecciona un archivo PDF v√°lido.');
            return;
        }
        window.currentFile = file;
        document.querySelector('.upload-text').textContent = `Archivo seleccionado: ${file.name}`;
    }

    // Agrega estas funciones utilitarias:
    function arrayBufferToBase64(buffer) {
        let binary = '';
        const bytes = new Uint8Array(buffer);
        const len = bytes.byteLength;
        for (let i = 0; i < len; i++) {
            binary += String.fromCharCode(bytes[i]);
        }
        return window.btoa(binary);
    }

    function base64ToArrayBuffer(base64) {
        const binary_string = window.atob(base64);
        const len = binary_string.length;
        const bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes.buffer;
    }

    // Guarda los PDFs en localStorage
    function savePDFsToLocalStorage() {
        const docsToSave = pdfDocuments.map(doc => ({
            ...doc,
            data: arrayBufferToBase64(doc.data)
        }));
        localStorage.setItem('itc_pedia_pdfs', JSON.stringify(docsToSave));
    }

    // Carga los PDFs desde localStorage
    function loadPDFsFromLocalStorage() {
        const saved = localStorage.getItem('itc_pedia_pdfs');
        if (saved) {
            pdfDocuments = JSON.parse(saved).map(doc => ({
                ...doc,
                data: base64ToArrayBuffer(doc.data)
            }));
        } else {
            pdfDocuments = [];
        }
    }

    // Modifica uploadDocument y deleteDocument para guardar en localStorage
    function uploadDocument() {
        if (!window.currentFile) {
            alert('Por favor, selecciona un archivo PDF primero.');
            return;
        }
        const title = document.getElementById('docTitle').value.trim();
        const description = document.getElementById('docDescription').value.trim();
        const category = document.getElementById('docCategory').value;
        if (!title) {
            alert('Por favor, ingresa un t√≠tulo para el documento.');
            return;
        }
        const fileReader = new FileReader();
        fileReader.onload = function() {
            const pdfData = this.result;
            const newDoc = {
                id: Date.now(),
                title: title,
                description: description || 'Sin descripci√≥n',
                category: category,
                uploadDate: new Date().toLocaleDateString('es-ES'),
                size: `${(window.currentFile.size / 1024 / 1024).toFixed(2)} MB`,
                data: pdfData
            };
            pdfDocuments.unshift(newDoc);
            savePDFsToLocalStorage(); // Guarda en localStorage
            renderPDFGrid();
            clearForm();
            alert('Documento subido exitosamente!');
        };
        fileReader.readAsArrayBuffer(window.currentFile);
    }

    function clearForm() {
        document.getElementById('docTitle').value = '';
        document.getElementById('docDescription').value = '';
        document.getElementById('docCategory').value = 'Manual';
        document.getElementById('fileInput').value = '';
        document.querySelector('.upload-text').textContent = 'Arrastra tu archivo PDF aqu√≠';
        window.currentFile = null;
    }

    function renderPDFGrid() {
        const grid = document.getElementById('pdfGrid');
        const emptyState = document.getElementById('emptyState');
        if (pdfDocuments.length === 0) {
            grid.style.display = 'none';
            emptyState.style.display = 'block';
            return;
        }
        grid.style.display = 'grid';
        emptyState.style.display = 'none';
        grid.innerHTML = pdfDocuments.map(doc => `
            <div class="pdf-card" onclick="openPDF(${doc.id})">
                <div class="pdf-icon">üìÑ</div>
                <div class="pdf-title">${doc.title}</div>
                <div class="pdf-description">${doc.description}</div>
                <div class="pdf-meta">
                    <span>${doc.uploadDate}</span>
                    <span>${doc.size}</span>
                </div>
                <div class="pdf-category">${doc.category}</div>
                ${currentMode === 'admin' ? `
                    <div class="admin-controls">
                        <button class="btn-danger" onclick="event.stopPropagation(); deleteDocument(${doc.id})">Eliminar</button>
                    </div>
                ` : ''}
            </div>
        `).join('');
    }

    function filterDocuments(searchTerm) {
        const cards = document.querySelectorAll('.pdf-card');
        const term = searchTerm.toLowerCase();
        cards.forEach(card => {
            const title = card.querySelector('.pdf-title').textContent.toLowerCase();
            const description = card.querySelector('.pdf-description').textContent.toLowerCase();
            const category = card.querySelector('.pdf-category').textContent.toLowerCase();
            if (title.includes(term) || description.includes(term) || category.includes(term)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }

    function openPDF(docId) {
        const doc = pdfDocuments.find(d => d.id === docId);
        if (!doc) return;
        document.getElementById('viewerTitle').textContent = doc.title;
        document.getElementById('pdfViewer').style.display = 'block';
        document.getElementById('pdfViewer').scrollIntoView({ behavior: 'smooth' });
        const typedarray = new Uint8Array(doc.data);
        loadPDF(typedarray);
    }

    function loadPDF(pdfData) {
        pdfjsLib.getDocument(pdfData).promise.then(pdf => {
            pdfDoc = pdf;
            currentPage = 1;
            scale = 1.0;
            userZoom = false;
            autoScale = 1.0;
            renderPage();
        }).catch(error => {
            console.error('Error loading PDF:', error);
            alert('Error al cargar el PDF.');
        });
    }

    function renderPage() {
        if (!pdfDoc) return;
        pdfDoc.getPage(currentPage).then(page => {
            const maxWidth = window.innerWidth * 0.95;
            const maxHeight = window.innerHeight - 200;

            // Calcula autoScale solo la primera vez (cuando no hay zoom manual)
            if (!userZoom) {
                let viewport = page.getViewport({ scale: 1.0 });
                let scaleX = maxWidth / viewport.width;
                let scaleY = maxHeight / viewport.height;
                autoScale = Math.min(scaleX, scaleY, 1);
            }

            let finalScale = autoScale * scale;
            let viewport = page.getViewport({ scale: finalScale });

            // Ajusta el tama√±o del canvas
            canvas.width = viewport.width;
            canvas.height = viewport.height;

            // Ajusta el tama√±o de las capas
            const textLayerDiv = document.getElementById('textLayer');
            const annotationLayerDiv = document.getElementById('annotationLayer');
            textLayerDiv.innerHTML = '';
            textLayerDiv.style.width = canvas.width + 'px';
            textLayerDiv.style.height = canvas.height + 'px';
            annotationLayerDiv.innerHTML = '';
            annotationLayerDiv.style.width = canvas.width + 'px';
            annotationLayerDiv.style.height = canvas.height + 'px';

            // Renderiza el canvas
            const renderContext = {
                canvasContext: ctx,
                viewport: viewport
            };
            page.render(renderContext);

            // Renderiza la capa de texto (seleccionable y alineada)
            page.getTextContent().then(function(textContent) {
                pdfjsLib.renderTextLayer({
                    textContent,
                    container: textLayerDiv,
                    viewport,
                    enhanceTextSelection: true
                });
            });

            // Renderiza la capa de anotaciones (enlaces)
            page.getAnnotations({ intent: 'display' }).then(function(annotations) {
                pdfjsLib.renderAnnotationLayer({
                    annotations,
                    div: annotationLayerDiv,
                    page,
                    viewport,
                    linkService: new pdfjsLib.SimpleLinkService(),
                    renderInteractiveForms: false
                });
            });

            updatePageInfo();
        });
    }

    function updatePageInfo() {
        document.getElementById('pageInfo').textContent = `P√°gina ${currentPage} de ${pdfDoc.numPages}`;
        // Muestra el zoom real en porcentaje
        document.getElementById('zoomLevel').textContent = `${Math.round(autoScale * scale * 100)}%`;
    }

    function previousPage() {
        if (currentPage > 1) {
            currentPage--;
            renderPage();
        }
    }

    function nextPage() {
        if (currentPage < pdfDoc.numPages) {
            currentPage++;
            renderPage();
        }
    }

    function zoomIn() {
        userZoom = true;
        scale = Math.min(scale + 0.2, 6.0); // Permite hasta 600%
        renderPage();
    }

    function zoomOut() {
        userZoom = true;
        scale = Math.max(scale - 0.2, 0.2); // Permite hasta 20%
        renderPage();
    }

    function closePDFViewer() {
        document.getElementById('pdfViewer').style.display = 'none';
        pdfDoc = null;
        currentPage = 1;
        scale = 1.0;
    }

    function deleteDocument(docId) {
        if (confirm('¬øEst√°s seguro de que quieres eliminar este documento?')) {
            pdfDocuments = pdfDocuments.filter(doc => doc.id !== docId);
            savePDFsToLocalStorage(); // Guarda en localStorage
            renderPDFGrid();
        }
    }

    function loadSampleDocuments() {
        // No cargar documentos de ejemplo
        pdfDocuments = [];
    }

    document.addEventListener('DOMContentLoaded', function() {
        function actualizarUsuarioNav() {
            const user = getUsuarioLogueado();
            const userInfo = document.getElementById('user-info');
            const logoutBtn = document.getElementById('logout-btn');
            if (user) {
                userInfo.textContent = user.username;
                logoutBtn.style.display = 'inline-block';
            } else {
                userInfo.textContent = '';
                logoutBtn.style.display = 'none';
                // Redirige si no hay sesi√≥n iniciada
                window.location.href = "index.html";
            }
        }

        actualizarUsuarioNav();

        document.getElementById('logout-btn').addEventListener('click', function() {
            logout();
            actualizarUsuarioNav();
        });
    });

    // Al iniciar la p√°gina, carga desde localStorage
    document.addEventListener('DOMContentLoaded', function() {
        loadPDFsFromLocalStorage();
        renderPDFGrid();
        // ...el resto de tu c√≥digo...
    });
    </script>
</body>
</html>